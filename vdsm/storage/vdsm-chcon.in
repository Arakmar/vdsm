#!/bin/sh

# This script must be called from a udev rule and assumes the udev environment
# variables.

# Do not touch the device if it is already labelled is libvirt image. It will
# probably be a fixed_disk_t or it may have no selinux label.
if @LS_PATH@ -Z "$DEVNAME" | \
    @GREP_PATH@ -q -E ":@SVIRT_CONTENT_LABEL@:|:@SVIRT_IMAGE_LABEL@:"; then
    exit 0
fi

echo "Changing selinux type to @SVIRT_IMAGE_LABEL@ on $DEVNAME" >&2
@CHCON_PATH@ -t @SVIRT_IMAGE_LABEL@ "$DEVNAME"
